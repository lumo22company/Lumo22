<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign up | Lumo 22</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/landing.css') }}?v={{ asset_version }}">
  <style>
    .auth-page { padding: 6rem 1.5rem 4rem; max-width: 420px; margin: 0 auto; }
    .auth-page h1 { font-family: var(--font-display); font-size: 1.75rem; margin-bottom: 0.5rem; }
    .auth-page .sub { color: var(--lum-text-muted); margin-bottom: 2rem; }
    .auth-page label { display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 0.5rem; }
    .auth-page input { width: 100%; padding: 0.75rem 1rem; background: var(--lum-surface-elevated); border: 1px solid var(--lum-border); border-radius: 8px; color: var(--lum-text); margin-bottom: 1.25rem; }
    .auth-page .btn { display: inline-block; padding: 1rem 2rem; background: var(--lum-gold); color: #000; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; width: 100%; }
    .auth-page .btn:hover { opacity: 0.95; }
    .auth-page .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .auth-page .msg { margin-top: 1rem; padding: 0.75rem; border-radius: 8px; font-size: 0.95rem; }
    .auth-page .msg.error { background: rgba(200,80,80,0.15); color: var(--lum-text); }
    .auth-page .msg.success { background: rgba(76,175,80,0.15); color: var(--lum-text); }
    .auth-page .link { margin-top: 1.5rem; text-align: center; }
    .auth-page .link a { color: var(--lum-gold); text-decoration: none; }
    .auth-page .link a:hover { text-decoration: underline; }
  </style>
</head>
<body class="lumo-landing">
  <nav class="lumo-nav lumo-nav-scrolled">
    <a href="/" class="lumo-nav-logo">Lumo 22</a>
    <div class="lumo-nav-links">
      <a href="/captions">Captions</a>
    </div>
    <a href="/" class="lumo-nav-cta">Home</a>
  </nav>

  <main class="auth-page">
    <h1>Create your account</h1>
    <p class="sub">One account for your Captions.</p>

    <form id="signup-form">
      <input type="hidden" id="referral_code" name="referral_code" value="">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" required autocomplete="email" placeholder="you@example.com">

      <label for="password">Password <span style="font-weight:400;color:var(--lum-text-muted);">(min 6 characters)</span></label>
      <input type="password" id="password" name="password" required minlength="6" autocomplete="new-password">

      <label for="password_confirm">Confirm password</label>
      <input type="password" id="password_confirm" name="password_confirm" required minlength="6" autocomplete="new-password">

      <button type="submit" class="btn" id="btn">Create account</button>
      <div id="msg" class="msg" style="display: none;"></div>
    </form>

    <p class="link">Already have an account? <a href="/login">Log in</a></p>
    <p class="link"><a href="/">← Back to Lumo 22</a></p>
  </main>

  <script>
    (function() {
      var ref = (new URLSearchParams(window.location.search).get('ref') || '').trim();
      if (ref) document.getElementById('referral_code').value = ref;

      var form = document.getElementById('signup-form');
      var btn = document.getElementById('btn');
      var msg = document.getElementById('msg');

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        var pw = document.getElementById('password').value;
        var pw2 = document.getElementById('password_confirm').value;
        if (pw !== pw2) {
          msg.className = 'msg error';
          msg.textContent = 'Those passwords don\'t match.';
          msg.style.display = 'block';
          return;
        }
        msg.style.display = 'none';
        btn.disabled = true;
        btn.textContent = 'Creating…';

        var ref = (new URLSearchParams(window.location.search).get('ref') || document.getElementById('referral_code').value || '').trim();
        fetch('/api/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: document.getElementById('email').value.trim().toLowerCase(),
            password: pw,
            referral_code: ref || undefined
          })
        })
        .then(function(r) { return r.json(); })
        .then(function(data) {
          if (data.ok) {
            msg.className = 'msg success';
            msg.textContent = 'You\'re in. Taking you to your account…';
            msg.style.display = 'block';
            window.location.href = '/account';
          } else {
            msg.className = 'msg error';
            msg.textContent = data.error || 'Something didn\'t go through — try again.';
            msg.style.display = 'block';
            btn.disabled = false;
            btn.textContent = 'Create account';
          }
        })
        .catch(function() {
          msg.className = 'msg error';
          msg.textContent = 'Something didn\'t send — try again.';
          msg.style.display = 'block';
          btn.disabled = false;
          btn.textContent = 'Create account';
        });
      });
    })();
  </script>
  {% include '_footer.html' %}
</body>
</html>
